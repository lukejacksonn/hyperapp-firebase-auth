{"version":3,"file":"index.js","sources":["../src/form.js","../src/index.js"],"sourcesContent":["import { h } from 'hyperapp'\n\nconst parseFormInputs = form =>\n  Array.from(form.elements)\n    .filter(input => input.type !== 'submit')\n    .reduce((a,{ name, value }) => Object.assign(a, { [name]: value }), {})\n\nexport default ({\n  key = 'form-' + Math.floor(Math.random()*100),\n  titleText = 'Untitled Form',\n  promptText = 'Please fill out and submit the form below',\n  submitText = 'Submit',\n  inputs = [{ name: 'lorem', type: 'text', placeholder: 'Example Input' }],\n  action = data => console.log('Submitted', data),\n  errorText = '',\n  links = []\n}) =>\nh('form', {\n  key,\n  oncreate: e => e.elements[0].focus(),\n  onsubmit: e => {\n    e.preventDefault()\n    return action(parseFormInputs(e.target))\n  }\n},[\n  h('header', {}, [\n    h('h3', {}, titleText),\n    h('p', {}, promptText),\n  ]),\n  inputs.map(props => h('label', { style: { display: props.type === 'hidden' ? 'none' : false }}, h('input', props))),\n  errorText && h('error-', {}, errorText),\n  h('button', { type: 'submit' }, submitText),\n  h('footer', {}, links.map(x =>\n    h('a', { href: '#', onclick: e => e.preventDefault() || x.action() }, x.text)\n  )),\n])\n","import { h } from 'hyperapp'\nimport $form from './form'\n\nconst auth = firebase.auth()\n\nconst $identity = (s,a) => $form({\n  key: 'identity-form',\n  titleText: 'Identity Required',\n  promptText: `New and existing users please enter your email address to continue`,\n  submitText: 'Continue',\n  errorText: s.firebaseAuth.error.message,\n  inputs: [{\n    name: 'email', type: 'email', placeholder: 'Email Address', autocomplete: 'email'\n  }],\n  action: a.firebaseAuth.fetchProviders,\n})\n\nconst $signin = (s,a) => $form({\n  key: 'signin-form',\n  titleText: 'Existing Identity',\n  promptText: 'In order for us to confirm your identity please enter your password.',\n  submitText: 'Sign In',\n  errorText: s.firebaseAuth.error.message,\n  inputs: [\n    { name: 'password', type: 'password', placeholder: 'Password' },\n    { name: 'email', type: 'hidden', value: s.firebaseAuth.user.email },\n  ],\n  action: a.firebaseAuth.signin,\n  links: [\n    { text: 'Sign in with a different identity', action: a.firebaseAuth.resetIdentity },\n    { text: 'Reset password', action: a.firebaseAuth.resetPassword },\n  ],\n})\n\nconst $signup = (s,a) => $form({\n  key: 'signup-form',\n  titleText: 'New Identity',\n  promptText: 'Please confirm your email address and a set a secure password.',\n  submitText: 'Create User',\n  errorText: s.firebaseAuth.error.message,\n  inputs: [\n    { name: 'email', type: 'email', value: s.firebaseAuth.user.email },\n    { name: 'password', type: 'password', placeholder: 'Password' },\n  ],\n  action: a.firebaseAuth.signup,\n  links: [\n    { text: 'Sign in with a different identity', action: a.firebaseAuth.resetIdentity }\n  ],\n})\n\nconst $auth = (s,a) =>\n  h('dialog', {}, [\n    !s.firebaseAuth.user.email\n      ? $identity(s,a)\n      : s.firebaseAuth.hasIdentity.length ? $signin(s,a) : $signup(s,a),\n  ])\n\nvar state = {\n  firebaseAuth: {\n    authed: false,\n    checked: false,\n    user: {},\n    error: {},\n    hasIdentity: [],\n  }\n};\n\nconst actions = {\n  firebaseAuth: {\n    setHasIdentity: hasIdentity => ({ hasIdentity }),\n    setUser: user => ({ user }),\n    setError: error => ({ error }),\n    signout: () => {auth.signOut()},\n    signin: ({email, password}) => (s,a,) => {\n      a.setError({})\n      auth.signInWithEmailAndPassword(email, password)\n        .catch(a.setError)\n    },\n    signup: ({email, password}) => (s,a,) => {\n      a.setError({})\n      a.setUser({ email })\n      auth.createUserWithEmailAndPassword(email, password)\n        .catch(a.setError)\n    },\n    fetchProviders: ({email}) => (s,a,) => {\n      a.setError({})\n      auth.fetchProvidersForEmail(email)\n        .then(providers => {\n          a.setUser({ email })\n          a.setHasIdentity(providers)\n        }).catch(a.setError)\n    },\n    userChanged: user => (s,a) => ({\n      user: user || {},\n      authed: !!user,\n      checked: true,\n    }),\n    resetPassword: d => (s,a) =>\n      confirm(`Send a password reset email to ${s.user.email}?`) &&\n      auth.sendPasswordResetEmail(s.user.email).then(_ =>\n        alert(`A password reset email has been sent to ${s.user.email} please check your inbox.`)\n      ).catch(a.setError),\n    resetIdentity: () => ({\n      user: {}, \n      error: {}\n    }),\n  }\n};\n\nconst authf = v => (s, a) => {\n  if(!s.firebaseAuth.checked) \n    return h('auth-check')\n  if(!s.firebaseAuth.authed && v(s,a).props.auth)  \n    return $auth(s,a);\n  return v(s,a);\n}\n\nconst faView = v => (s, a) => h(\"div\", {\n    id: \"auth\",\n    oncreate: e => auth.onAuthStateChanged(a.firebaseAuth.userChanged),\n  }, \n  authf(v)(s,a)\n);\n\nconst faState = s => Object.assign({}, s, state);\nconst faActions = a => Object.assign({}, a, actions);\n\nexport  {\n  faState,\n  faActions,\n  faView\n};\n"],"names":["h"],"mappings":"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"}